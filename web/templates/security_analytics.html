<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Analytics</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/security_analytics.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='icons/metrics-dashboard-icon.ico') }}" type="image/x-icon">

    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
</head>
<body>
<!-- Top Navigation Bar -->
<div class="top-nav">
    <div class="nav-burger" onclick="toggleMenu()">
        <img src="{{ url_for('static', filename='icons/burger.svg') }}" alt="Menu" class="nav-icon">
    </div>
    <div id="burgerMenu" class="burger-menu-content" style="display:none;">
        <a href="/">Home Dashboard</a>
        <a href="/xsoar">XSOAR Dashboard</a>
        <a href="/msoc-form">MSOC Form</a>
        <a href="/speak-up-form">Speak Up Form</a>
        <a href="/travel-form">Travel Form</a>
        <a href="/red-team-testing-form">Red Team Testing</a>
        <a href="/xsoar-ticket-import-form">XSOAR Ticket Import</a>
        <a href="/apt-other-names-search">APT Other Names Search</a>
    </div>
</div>

<audio id="music" src="" loop muted></audio>
<div class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">
    ğŸŒ™
</div>
<div class="audio-controls">
    <button onclick="toggleAudio()">
        <img src="/static/icons/volume-xmark-solid.svg" alt="Unmute Icon" class="music-icon" id="music-icon">
    </button>
</div>

<div class="dashboard-container">
    <div class="dashboard-header">
        <h1 class="dashboard-title">Security Incident Analytics</h1>
        <p class="dashboard-subtitle">Real-time analytics and insights from XSOAR security incidents</p>
    </div>

    <!-- Filters Section -->
    <div class="filters-section">
        <div class="filters-header">
            ğŸ›ï¸ Filter Controls
        </div>
        <div class="filters-grid">
            <div class="filter-group">
                <label class="filter-label">ğŸ“… Date Range</label>
                <div class="radio-filter-box">
                    <label><input type="radio" name="dateRange" value="7"> Last 7 days</label>
                    <label><input type="radio" name="dateRange" value="30" checked> Last 30 days</label>
                    <label><input type="radio" name="dateRange" value="60"> Last 60 days</label>
                    <label><input type="radio" name="dateRange" value="90"> Last 90 days</label>
                </div>
            </div>
            <div class="filter-group">
                <label class="filter-label">ğŸŒ Country</label>
                <div id="countryFilter" class="checkbox-filter">
                </div>
            </div>
            <div class="filter-group">
                <label class="filter-label">ğŸ’¥ Impact Level</label>
                <div id="impactFilter" class="checkbox-filter">
                </div>
            </div>
            <div class="filter-group">
                <label class="filter-label">ğŸš¨ Severity</label>
                <div id="severityFilter" class="checkbox-filter">
                    <label><input type="checkbox" value="4"> Critical</label>
                    <label><input type="checkbox" value="3"> High</label>
                    <label><input type="checkbox" value="2"> Medium</label>
                    <label><input type="checkbox" value="1"> Low</label>
                </div>
            </div>
            <div class="filter-group ticket-type-filter">
                <label class="filter-label">ğŸ« Ticket Type</label>
                <div id="ticketTypeFilter" class="checkbox-filter">
                </div>
            </div>
            <div class="filter-group">
                <label class="filter-label">ğŸ“Š Status</label>
                <div id="statusFilter" class="checkbox-filter">
                    <label><input type="checkbox" value="0"> Pending</label>
                    <label><input type="checkbox" value="1"> Active</label>
                    <label><input type="checkbox" value="2"> Closed</label>
                </div>
            </div>
        </div>

        <!-- Filter Summary -->
        <div class="filter-summary" id="filterSummary">
            <div class="filter-summary-content">
                <strong>Active Filters:</strong>
                <span class="active-filters-container" id="activeFiltersContainer">
                    <span class="filter-tag">Last 30 days</span>
                </span>
            </div>
            <button class="clear-all-btn" onclick="clearAllFilters()">Clear All</button>
        </div>
    </div>

    <!-- Loading/Error Display -->
    <div id="loading" class="loading">
        ğŸ”„ Loading security incident data...
    </div>
    <div id="error" class="error" style="display: none;"></div>

    <!-- Metrics Cards -->
    <div id="metricsGrid" class="metrics-grid" style="display: none;">
        <!-- Metrics will be populated by JavaScript -->
    </div>

    <!-- Charts Grid -->
    <div id="chartsGrid" class="charts-grid" style="display: none;">
        <div class="chart-container">
            <div class="chart-title">ğŸŒ Geographic Distribution</div>
            <div id="geoChart" class="chart-canvas"></div>
        </div>
        <div class="chart-container">
            <div class="chart-title">ğŸš¨ Severity Distribution</div>
            <div id="severityChart" class="chart-canvas"></div>
        </div>
        <div class="chart-container">
            <div class="chart-title">ğŸ“ˆ Daily Incident Timeline</div>
            <div id="timelineChart" class="chart-canvas"></div>
        </div>
        <div class="chart-container">
            <div class="chart-title">ğŸ« Ticket Types</div>
            <div id="ticketTypeChart" class="chart-canvas"></div>
        </div>
        <div class="chart-container">
            <div class="chart-title">ğŸ’¥ Impact vs Status Heatmap</div>
            <div id="heatmapChart" class="chart-canvas"></div>
        </div>
        <div class="chart-container">
            <div class="chart-title">ğŸ”„ Incident Status Funnel</div>
            <div id="funnelChart" class="chart-canvas"></div>
        </div>
    </div>

    <!-- Data Table -->
    <div id="dataTableSection" class="data-table-section" style="display: none;">
        <div class="table-header">ğŸ“‹ Case Details</div>
        <div style="overflow-x: auto;">
            <table id="dataTable" class="data-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Severity</th>
                    <th>Status</th>
                    <th>Country</th>
                    <th>Impact</th>
                    <th>Source</th>
                    <th>Created</th>
                </tr>
                </thead>
                <tbody>
                <!-- Table rows will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
        <div class="export-section">
            <button class="export-btn" onclick="exportToCSV()">ğŸ“¥ Export to CSV</button>
            <button class="export-btn" onclick="exportSummary()">ğŸ“Š Export Summary</button>
        </div>
    </div>
</div>

<script src="/static/js/common.js"></script>
<script src="{{ url_for('static', filename='js/security_analytics.js') }}"></script>
<script>
    initRandomMusic();
</script>
</body>
</html>