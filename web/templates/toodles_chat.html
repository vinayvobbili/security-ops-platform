{% extends 'base_layout.html' %}
{% set page_title_text = 'Toodles' %}
{% set page_title_left_icon = 'ğŸ¤–' %}
{% block extra_css %}<link rel="stylesheet" href="{{ url_for('static', filename='css/toodles_chat.css') }}">{% endblock %}
{% block content %}
<div class="chat-page">
    <div class="chat-container">
        <div class="chat-header">
            <div class="bot-avatar">ğŸ¤–</div>
            <h1>Toodles</h1>
        </div>
        <div class="chat-messages" id="chatMessages">
            <!-- Messages will be added here dynamically -->
        </div>
    </div>
</div>

<button class="clear-chat-button" id="clearChatButton">
    <span class="button-icon">ğŸ—‘ï¸</span>
    <span class="button-text">Clear Chat</span>
</button>

<!-- Authentication Modal (shown by default, hidden if already authenticated) -->
<div id="authModal" class="modal" style="display: {{ 'none' if session.get('toodles_authenticated') else 'block' }}">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Welcome to Toodles</h2>
        </div>
        <div class="modal-body">
            <form id="authForm" onsubmit="submitAuth(event)">
                <div class="form-group">
                    <label for="emailLocal">Enter your email address</label>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <input type="text"
                               id="emailLocal"
                               name="emailLocal"
                               required
                               placeholder="firstname.lastname"
                               style="flex: 1;"
                               autocomplete="off">
                        <span style="color: #666; font-weight: 500;">@{{ config.email_domain }}</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="password">Enter password</label>
                    <input type="password"
                           id="password"
                           name="password"
                           required
                           placeholder="Password"
                           autocomplete="off">
                </div>
                <div id="authError" style="color: red; display: none; margin-top: 10px;"></div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Continue</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal for forms -->
<div id="formModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">Form</h2>
            <button class="close-button" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body" id="modalBody">
            <!-- Form content will be injected here -->
        </div>
    </div>
</div>
{% endblock %}
{% block extra_js %}<script src="{{ url_for('static', filename='js/toodles_chat.js') }}"></script>{% endblock %}
